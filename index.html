<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã˜ã‚ƒã‚“ã‘ã‚“ã‚„ã‚Šç›´ã—</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="janken_yarinaoshi_style.css" />
</head>

<body>
    <h1>ã˜ã‚ƒã‚“ã‘ã‚“</h1>

    <div class="rules">
        <h2>
            ã€ãƒ«ãƒ¼ãƒ«ã€‘<br />
            åˆ¶é™æ™‚é–“ï¼–ï¼ç§’ä»¥å†…ã§é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ã›ï¼<br />
            ã˜ã‚ƒã‚“ã‘ã‚“ã«å‹ã¤ã¨ã€€ï¼‹ï¼’ï¼ç‚¹<br />
            è² ã‘ã‚‹ã¨ã€€âˆ’ï¼’ï¼ç‚¹<br />
            ã‚¯ãƒªãƒƒã‚¯æ“ä½œãŒãªã„ã¨ã€€ï¼‘ç§’ã”ã¨ã« ãƒ¼ï¼’ï¼ç‚¹<br />
            â­ï¸ã‚„ğŸ’©ã‚’æŠ¼ã—ã¦ã‚‚ç‚¹æ•°ãŒåŠ æ¸›ã•ã‚Œã‚‹ã‚ˆï¼<br />
            å¤§ãã„ã‚‚ã®ã»ã©åŠ æ¸›ã®æ•°å€¤ãŒå¤§ãã„ã‚ˆï¼
        </h2>
    </div>

    <h2 id="timeLeft">æ®‹ã‚Šæ™‚é–“ï¼š60ç§’</h2>
    <h2 id="score">ã‚¹ã‚³ã‚¢ï¼š0</h2>
    <h2 id="result"></h2>
    <h2 id="finalScore" style="display:none;"></h2>

    <div class="jankenArea">
        <div id="comArea">
            <h3>COM</h3>
            <div class="comHandStyle" id="comHandImage"></div>
        </div>
        <div id="playerArea">
            <h3>PLAYER</h3>
            <div id="sentakushi">
                <div class="handStyle" id="guu">âœŠ</div>
                <div class="handStyle" id="choki">âœŒï¸</div>
                <div class="handStyle" id="paa">âœ‹</div>
            </div>
        </div>
    </div>

    <script>
        const handMap = { guu: "âœŠ", choki: "âœŒï¸", paa: "âœ‹" };
        let scoreNumber = 0;
        let lastActionTime = Date.now();
        let gameEnded = false;
        let gameStarted = false;

        function startGame() {
            let remainingTime = 60;

            const countdown = setInterval(() => {
                if (gameEnded) {
                    clearInterval(countdown);
                    return;
                }

                remainingTime--;
                $("#timeLeft").text(`æ®‹ã‚Šæ™‚é–“ï¼š${remainingTime}ç§’`);

                const now = Date.now();
                if (now - lastActionTime >= 1000) {
                    scoreNumber -= 20;
                    $("#score").html(`ã‚¹ã‚³ã‚¢ï¼š${scoreNumber}`);
                    lastActionTime = now;
                }

                if (remainingTime <= 0) {
                    clearInterval(countdown);
                }
            }, 1000);

            setTimeout(() => {
                gameEnded = true;
                $(".handStyle").off("click");
                $("#result").text("â° ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼ã‚²ãƒ¼ãƒ çµ‚äº†ï¼");
                $("#score").hide();
                $("#finalScore").text(`æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼š${scoreNumber}`).show();
            }, 60000);
        }

        $(".handStyle").on("click", function () {
            if (!gameStarted) {
                gameStarted = true;
                startGame();
            }
            if (gameEnded) return;
            lastActionTime = Date.now();

            const playerHand = $(this).attr("id");
            const comHand = Math.ceil(Math.random() * 3);
            const comHandName = comHand === 1 ? "guu" : comHand === 2 ? "choki" : "paa";

            let winner = "";
            if (playerHand === comHandName) {
                winner = "ã‚ã„ã“";
            } else if (
                (playerHand === "guu" && comHandName === "choki") ||
                (playerHand === "choki" && comHandName === "paa") ||
                (playerHand === "paa" && comHandName === "guu")
            ) {
                winner = "You WonğŸ¥³";
                scoreNumber += 20;
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const size = Math.floor(Math.random() * 70) + 20;
                        const emoji = $("<div>â­ï¸</div>").css({
                            position: "absolute",
                            top: "0",
                            right: `${Math.random() * 100}vw`,
                            fontSize: `${size}px`,
                            zIndex: 3000,
                            cursor: "pointer",
                        });
                        emoji.on("click", function () {
                            const point = Math.floor(size / 2);
                            scoreNumber += point;
                            $("#score").html(`ã‚¹ã‚³ã‚¢ï¼š${scoreNumber}`);
                            $(this).remove();
                        });
                        $("body").append(emoji);
                        emoji.animate(
                            {
                                top: "100vh",
                                left: "-50vw",
                                opacity: 0,
                            },
                            3000,
                            function () {
                                $(this).remove();
                            }
                        );
                    }, i * 100);
                }
            } else {
                winner = "You LostğŸ¤ª";
                scoreNumber -= 20;
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const size = Math.floor(Math.random() * 40) + 20;
                        const left = Math.floor(Math.random() * 90);
                        const emoji = $("<div>ğŸ’©</div>").css({
                            position: "absolute",
                            top: "0",
                            left: `${left}vw`,
                            fontSize: `${size}px`,
                            zIndex: 3000,
                            cursor: "pointer",
                        });
                        emoji.on("click", function () {
                            scoreNumber -= Math.floor(size / 2);
                            $("#score").html(`ã‚¹ã‚³ã‚¢ï¼š${scoreNumber}`);
                            $(this).remove();
                        });
                        $("body").append(emoji);
                        emoji.animate(
                            {
                                top: "100vh",
                                opacity: 0,
                            },
                            3000,
                            function () {
                                $(this).remove();
                            }
                        );
                    }, i * 200);
                }
            }

            $("#comHandImage").html(handMap[comHandName]);
            $("#result").html(winner);
            $("#score").html(`ã‚¹ã‚³ã‚¢ï¼š${scoreNumber}`);
        });
    </script>
</body>

</html>
